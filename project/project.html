<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title> Project!!! </title>
	<style>
		body {
			padding-top : 100px;
			padding-bottom : 100px;
		}
	</style>
    <link rel="stylesheet" href="css/leaflet.css"/>
    <link rel="stylesheet" href="css/style.css"/>
	<!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">	
</head>
<body>

	<div class="row">
  		<div class="col-md-9" id="formap"></div>
  		<div class="col-md-3" id="forrigthbox"></div>
	</div>

	<div class="row">
  		<div class="col-md-9" id="forbottom"></div>  		
	</div>
	
	<div class="choixRegion">
        <label for="region"> DRG: </label>
        <select id="region" size="1"></select>
    </div>

	<script type="text/javascript" src="javascript/util/d3.v3.js"></script>
	<script type="text/javascript" src="javascript/util/d3-tip.js"></script>
	<script type="text/javascript" src="javascript/util/topojson.v1.js"></script>
	<script type="text/javascript" src="javascript/util/leaflet.js"></script>
	<script type="text/javascript" src="javascript/util/queue.v1.js"></script>
	<script type="text/javascript" src="javascript/projectpreproc.js"></script>
	<script type="text/javascript" src="javascript/projectvisual.js"></script>
	<script type="text/javascript" src="javascript/righthandPanel.js"></script>
	<script type="text/javascript" src="javascript/bottomPanel.js"></script>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
	<script>
		
		
	var mapsvg = d3.select("#formap").append("svg")
		//.attr("x", 0)
		//.attr("y", 0)
		.style("width", "100%")
		.attr("height", 500);
	
	var comparisonsvg = d3.select("#forrigthbox").append("svg")
		//.attr("x", 550)
		//.attr("y", 5)
		.attr("width", 180)
		.attr("height", 500);

	var bottomsvg = d3.select("#forbottom")
					.style("padding-top", "20px")
					.style("padding-left", "75px")
					.append("svg")
					.style("width", "100%")						
					.attr("height", 200);	
		
	var g = mapsvg.append("g");
	
	//call function to load the data)
	
	var projection = d3.geo.albersUsa()
				.scale(1070);//.translate([0,1980]);
				
	var path = d3.geo.path().projection(projection);
	
	var centered;
	var centeredCounty;
	
	var zoomlevel = "country";
	
	var DRGlist = [];
	
	var hospitalIDs = [];
	var markedHospitals = [];
	
	loadData();
	
	function ready(error, mapData, countiesMap, hospitalData, zipCodeData, hospitals) {	
		if (error) throw error;
		var centered = 0;
		
		var DRGchoice = 313;
		
		createHospitalObject(hospitalData);

		addRighthandPanel(comparisonsvg, hospitals);
		
		var hospwithcoord = createhospwithcoord(hospitals);
		

		
		var optionsList = [];
		optionsList.push("All DRGs");
		for (i = 0; i < DRGlist.length; i++) {
			optionsList.push(DRGlist[i]);
		}
		
		
		d3.select("select").selectAll("option")
			.data(optionsList)
			.enter()
			.append("option")
			.text(function(d) {
				return d;
			})
			
			
		d3.select("select").on("change", menuChange);
		
		
		createLayout(mapData, countiesMap, hospitals, hospwithcoord);
		
		
		//called if we change the dropdown menu. IT RESETS THE ARRAY THAT STORES THE HOSPITALS THAT WE HAVE CLICKED.
		function menuChange() {
			console.log("We have chosen another DRG in the menu: " + d3.select("select").property("value") + " aka " + parseInt(d3.select("select").property("value")));
			markedHospitals = [];
			bottomsvg.selectAll("svg > *").remove();
			createHospitalCircles(hospwithcoord, hospitals);
				
		}
		
//-----------------------------------------------
		
		bottomsvg.append("line")
			.attr("x1", 0)
			.attr("y1", 0)
			.attr("x2", 0)
			.attr("y2", 200)
			.attr("stroke-width", 2)
			.attr("stroke", "black");
					
		bottomsvg.append("line")
				.attr("x1", 500)
				.attr("y1", 0)
				.attr("x2", 500)
				.attr("y2", 200)
				.attr("stroke-width", 2)
				.attr("stroke", "black");
				
		bottomsvg.append("line")
				.attr("x1", 0)
				.attr("y1", 0)
				.attr("x2", 500)
				.attr("y2", 0)
				.attr("stroke-width", 2)
				.attr("stroke", "black");
				
		bottomsvg.append("line")
				.attr("x1", 0)
				.attr("y1", 200)
				.attr("x2", 500)
				.attr("y2", 200)
				.attr("stroke-width", 2)
				.attr("stroke", "black");
			
		bottomsvg.append('text').text("CLICK ON A HOSPITAL ON THE MAP OR IN THE RIGHT-HAND PANEL TO GET SOME INFORMATION!!!!")
				.attr('x', 5)
				.attr('y', 15)
				.attr('fill', 'red')
				.attr("font-family", "sans-serif")
				.style("font-weight","bold")
				.attr("font-size", "14px");
		
	//addBottomPanel(bottomsvg, hospitals, hospitalChoice);
		
	}	
	</script>
	</body>
</html>